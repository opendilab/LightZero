================================================================================
ORZ EVALUATOR - ç‹¬ç«‹è¯„æµ‹é¡¹ç›®
================================================================================

é¡¹ç›®ä½ç½®: /mnt/shared-storage-user/tangjia/orz/orz-eval

================================================================================
âœ“ é¡¹ç›®åˆ›å»ºæˆåŠŸï¼
================================================================================

ğŸ“¦ åŒ…å«æ–‡ä»¶ç»Ÿè®¡:
  - Pythonæºæ–‡ä»¶: 17ä¸ª
  - é…ç½®æ–‡ä»¶: 2ä¸ª (requirements.txt, *.md)
  - ç›®å½•ç»“æ„: å®Œæ•´çš„æ¨¡å—åŒ–è®¾è®¡
  - æ–‡æ¡£: 3ä»½ (README.md, QUICKSTART.md, PROJECT_SUMMARY.txt)

================================================================================
ğŸ“‚ ä¸»è¦ç»„ä»¶
================================================================================

1. ä¸»è¯„ä¼°è„šæœ¬:
   âœ“ eval_orz.py - å®Œæ•´çš„è¯„ä¼°æ¨¡å—ï¼Œæ”¯æŒé…ç½®é©±åŠ¨çš„è¯„ä¼°

2. æ ¸å¿ƒåº“ (orz/):
   âœ“ orz/ppo/
     - dataset.py (PromptDatasetåŸºç±»)
     - deepspeed_strategy.py (ç®€åŒ–çš„Strategyç±»)
     - vllm_utils.py (vLLMå¼•æ“å·¥å…·)
     - tools/math_utils.py (æ•°å­¦ç­”æ¡ˆéªŒè¯)
   
   âœ“ orz/exp_engine/
     - accelerators/inference/vllm_engine.py (vLLMæ¨ç†å¼•æ“)
     - accelerators/inference/vllm_worker_wrap.py (vLLM worker)
     - parallels/orz_distributed_c10d.py (åˆ†å¸ƒå¼é€šä¿¡)

3. æ•°æ®é›†å¤„ç†:
   âœ“ dataset/eval_dataset.py (EvalCustomDatasetç±»)

4. é…ç½®å’Œæ–‡æ¡£:
   âœ“ requirements.txt - é¡¹ç›®ä¾èµ–åˆ—è¡¨
   âœ“ README.md - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
   âœ“ QUICKSTART.md - å¿«é€Ÿå¼€å§‹æŒ‡å—
   âœ“ data/eval_data/ - æ•°æ®é›†ç›®å½•

================================================================================
ğŸš€ å¿«é€Ÿå¼€å§‹
================================================================================

1. å®‰è£…ä¾èµ–:
   $ cd /mnt/shared-storage-user/tangjia/orz/orz-eval
   $ pip install -r requirements.txt

2. å‡†å¤‡æ•°æ®:
   å°†JSONæ ¼å¼çš„æ•°æ®é›†æ”¾åœ¨ data/eval_data/ ç›®å½•ä¸‹
   æ•°æ®æ ¼å¼è¦æ±‚: 
   [
     {
       "prompt": [{"value": "é—®é¢˜å†…å®¹"}],
       "final_answer": "\\boxed{ç­”æ¡ˆ}"
     }
   ]

3. ä¿®æ”¹é…ç½®:
   ç¼–è¾‘ eval_orz.py ä¸­çš„:
   - path = "ä½ çš„æ¨¡å‹checkpointè·¯å¾„"
   - eval_config.eval_prompt_data = ["data/eval_data/ä½ çš„æ•°æ®é›†.json"]

4. è¿è¡Œè¯„ä¼°:
   $ python eval_orz.py

================================================================================
ğŸ”§ å…³é”®ç‰¹æ€§
================================================================================

âœ“ å®Œå…¨ç‹¬ç«‹ - æ— éœ€ä¾èµ–åŸå§‹è®­ç»ƒä»£ç åº“
âœ“ é«˜æ•ˆæ¨ç† - åŸºäºvLLMçš„å¹¶è¡Œæ¨ç†å¼•æ“
âœ“ çµæ´»é…ç½® - ä½¿ç”¨EvaluatorConfigè¿›è¡Œç»†ç²’åº¦æ§åˆ¶
âœ“ å¼‚æ­¥å¤„ç† - å¼‚æ­¥æ¶æ„æ”¯æŒé«˜æ•ˆå¹¶è¡Œå¤„ç†
âœ“ æ•°å­¦éªŒè¯ - ä½¿ç”¨SymPyè¿›è¡Œç²¾ç¡®çš„æ•°å­¦ç­”æ¡ˆæ¯”è¾ƒ
âœ“ è¯¦ç»†ç»“æœ - ç»“æœä¿å­˜ä¸ºJSONLæ ¼å¼ï¼Œå¯ç¦»çº¿åˆ†æ
âœ“ å¤šæ•°æ®é›† - æ”¯æŒåŒæ—¶è¯„ä¼°å¤šä¸ªæ•°æ®é›†

================================================================================
ğŸ“Š é…ç½®å‚æ•°ç¤ºä¾‹
================================================================================

EvaluatorConfig(
    model_path="checkpoint_path_or_hf_model_id",
    tokenizer_path="tokenizer_path",
    vllm_num_engines=1,              # vLLMå¼•æ“æ•°
    vllm_tensor_parallel_size=1,     # å¼ é‡å¹¶è¡Œåº¦
    enable_prefix_caching=True,       # å‰ç¼€ç¼“å­˜
    gpu_memory_utilization=0.3,       # GPUå†…å­˜åˆ©ç”¨ç‡
    max_model_len=8192,               # æ¨¡å‹æœ€å¤§é•¿åº¦
    temperature=1.0,                  # ç”Ÿæˆæ¸©åº¦
    generate_max_len=8000,            # æœ€å¤§ç”Ÿæˆé•¿åº¦
    eval_prompt_data=[                # è¯„ä¼°æ•°æ®é›†
        "data/eval_data/math500.json",
        "data/eval_data/aime2024.json",
    ],
    output_dir="eval_results",        # è¾“å‡ºç›®å½•
)

================================================================================
ğŸ“ ä½¿ç”¨ç¤ºä¾‹
================================================================================

from eval_orz import Evaluator, EvaluatorConfig
import asyncio

config = EvaluatorConfig(
    model_path="Qwen/Qwen2.5-7B",  # æˆ–checkpointè·¯å¾„
    eval_prompt_data=["data/eval_data/math500.json"],
)

evaluator = Evaluator(config)
try:
    results = asyncio.run(evaluator.eval())
    print(f"å‡†ç¡®ç‡: {results['eval_accuracy']:.2%}")
finally:
    evaluator.cleanup()

================================================================================
ğŸ”— æ–‡ä»¶ä¾èµ–å…³ç³»
================================================================================

eval_orz.py
â”œâ”€â”€ orz.ppo.tools.math_utils (is_equal, solution2answer)
â”œâ”€â”€ orz.ppo.deepspeed_strategy (DeepspeedStrategy)
â”œâ”€â”€ orz.ppo.vllm_utils (create_vllm_engines)
â””â”€â”€ dataset.eval_dataset (EvalCustomDataset)
    â””â”€â”€ orz.ppo.dataset (PromptDataset)

æ‰€æœ‰ä¾èµ–éƒ½å·²åŒ…å«åœ¨é¡¹ç›®ä¸­ï¼Œæ— éœ€å¤–éƒ¨å‚è€ƒã€‚

================================================================================
âš™ï¸ ç³»ç»Ÿè¦æ±‚
================================================================================

- GPU: æ”¯æŒCUDAçš„GPU (æ¨è24GB+)
- Python: 3.10+
- CUDA: 11.8+
- PyTorch: 2.0.0+
- vLLM: 0.3.0+

================================================================================
âœ… é¡¹ç›®å®Œæ•´æ€§æ£€æŸ¥æ¸…å•
================================================================================

âœ“ ç›®å½•ç»“æ„å®Œæ•´
âœ“ æ‰€æœ‰æºæ–‡ä»¶å·²å¤åˆ¶
âœ“ ä¾èµ–æ–‡ä»¶å·²ç®€åŒ–
âœ“ å¯¼å…¥è·¯å¾„å·²æ›´æ–°
âœ“ é…ç½®æ–‡ä»¶å·²åˆ›å»º
âœ“ æ–‡æ¡£å·²ç¼–å†™
âœ“ æ•°æ®ç›®å½•å·²åˆ›å»º
âœ“ æ— å¤–éƒ¨è®­ç»ƒä»£ç ä¾èµ–

================================================================================
ğŸ“– æ–‡æ¡£ä½ç½®
================================================================================

- è¯¦ç»†ä½¿ç”¨æ–‡æ¡£: README.md
- å¿«é€Ÿå¼€å§‹æŒ‡å—: QUICKSTART.md
- é¡¹ç›®æ€»ç»“: PROJECT_SUMMARY.txt (æœ¬æ–‡ä»¶)

================================================================================
ğŸ¯ åç»­æ­¥éª¤
================================================================================

1. è¯»å– QUICKSTART.md äº†è§£å¿«é€Ÿå¼€å§‹æ–¹æ³•
2. æŸ¥çœ‹ README.md äº†è§£æ‰€æœ‰é…ç½®é€‰é¡¹
3. å‡†å¤‡è¯„ä¼°æ•°æ®é›†
4. è¿è¡Œ python eval_orz.py è¿›è¡Œé¦–æ¬¡è¯„ä¼°
5. æ ¹æ®éœ€è¦è°ƒæ•´é…ç½®å‚æ•°

================================================================================
âœ¨ é¡¹ç›®åˆ›å»ºå®Œæˆï¼ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„è¯„æµ‹å·¥å…·ã€‚
   æ‰€æœ‰ä¾èµ–éƒ½åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼

================================================================================
