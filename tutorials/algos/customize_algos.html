<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to Customize Your Algorithms in LightZero? &mdash; LightZero 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/style.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Customize Your Environments in LightZero?" href="../envs/customize_envs.html" />
    <link rel="prev" title="Installation and Quick Start Guide" href="../installation/installation_and_quickstart.html" />
    <link href="../../_static/css/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            LightZero
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/installation_and_quickstart.html">Installation and Quick Start Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to Customize Your Algorithms in LightZero?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-steps"><strong>Basic Steps</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understand-the-framework-structure">1. Understand the Framework Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-policy-file">2. Create a New Policy File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implement-your-policy">3. Implement Your Policy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-collection-and-model-evaluation">Data Collection and Model Evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#policy-learning">Policy Learning</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#register-your-policy">4. Register Your Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#possible-other-modifications">5. Possible Other Modifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-your-policy">6. Test Your Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comprehensive-testing-and-running">7. Comprehensive Testing and Running</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contribution">8. Contribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#share-discuss-and-improve">9. Share, Discuss, and Improve</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#considerations"><strong>Considerations</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../envs/customize_envs.html">How to Customize Your Environments in LightZero?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/config.html">How to Set Configuration Files in LightZero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logs/logs.html">LightZero’s Logging and Monitoring System</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/agent/index.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/config/index.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/entry/index.html">Entry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/envs/index.html">Envs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/mcts/index.html">MCTS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/model/index.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/policy/index.html">Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/worker/index.html">Worker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">LightZero</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to Customize Your Algorithms in LightZero?</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/algos/customize_algos.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
    
    
  <section id="how-to-customize-your-algorithms-in-lightzero">
<h1>How to Customize Your Algorithms in LightZero?<a class="headerlink" href="#how-to-customize-your-algorithms-in-lightzero" title="Permalink to this heading"></a></h1>
<p>LightZero is an MCTS+RL reinforcement learning framework that provides a set of high-level APIs, enabling users to customize their algorithms within it. Here are some steps and considerations on how to customize an algorithm in LightZero.</p>
<section id="basic-steps">
<h2><strong>Basic Steps</strong><a class="headerlink" href="#basic-steps" title="Permalink to this heading"></a></h2>
<section id="understand-the-framework-structure">
<h3>1. Understand the Framework Structure<a class="headerlink" href="#understand-the-framework-structure" title="Permalink to this heading"></a></h3>
<p>Before you start coding your custom algorithms, you need to have a basic understanding of the LightZero framework’s structure. The LightZero pipeline is illustrated in the following diagram.</p>
<p align="center"> <img src="assets/lightzero_pipeline.svg" alt="Image" width="50%" height="auto" style="margin: 0 1%;"> 
</p><p>The repository’s folder consists primarily of two parts: <code class="docutils literal notranslate"><span class="pre">lzero</span></code> and <code class="docutils literal notranslate"><span class="pre">zoo</span></code>. The <code class="docutils literal notranslate"><span class="pre">lzero</span></code> folder contains the core modules required for the LightZero framework’s workflow. The <code class="docutils literal notranslate"><span class="pre">zoo</span></code> folder provides a set of predefined environments (<code class="docutils literal notranslate"><span class="pre">envs</span></code>) and their corresponding configuration (<code class="docutils literal notranslate"><span class="pre">config</span></code>) files. The <code class="docutils literal notranslate"><span class="pre">lzero</span></code> folder includes several core modules, including the <code class="docutils literal notranslate"><span class="pre">policy</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>, <code class="docutils literal notranslate"><span class="pre">worker</span></code>, and <code class="docutils literal notranslate"><span class="pre">entry</span></code>. These modules work together to implement complex reinforcement learning algorithms.</p>
<ul class="simple">
<li><p>In this architecture, the <code class="docutils literal notranslate"><span class="pre">policy</span></code> module is responsible for implementing the algorithm’s decision-making logic, such as action selection during agent-environment interaction and how to update the policy based on collected data. The <code class="docutils literal notranslate"><span class="pre">model</span></code> module is responsible for implementing the neural network structures required by the algorithm.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">worker</span></code> module consists of two classes: Collector and Evaluator. An instance of the Collector class handles the agent-environment interaction to collect the necessary data for training, while an instance of the Evaluator class evaluates the performance of the current policy.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">entry</span></code> module is responsible for initializing the environment, model, policy, etc., and its main loop implements core processes such as data collection, model training, and policy evaluation.</p></li>
<li><p>There are close interactions among these modules. Specifically, the <code class="docutils literal notranslate"><span class="pre">entry</span></code> module calls the Collector and Evaluator of the <code class="docutils literal notranslate"><span class="pre">worker</span></code> module to perform data collection and algorithm evaluation. The decision functions of the <code class="docutils literal notranslate"><span class="pre">policy</span></code> module are called by the Collector and Evaluator to determine the agent’s actions in a specific environment. The neural network models implemented in the <code class="docutils literal notranslate"><span class="pre">model</span></code> module are embedded in the <code class="docutils literal notranslate"><span class="pre">policy</span></code> object for action generation during interaction and for updates during the training process.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">policy</span></code> module, you can find implementations of various algorithms. For example, the MuZero policy is implemented in the <code class="docutils literal notranslate"><span class="pre">muzero.py</span></code> file.</p></li>
</ul>
</section>
<section id="create-a-new-policy-file">
<h3>2. Create a New Policy File<a class="headerlink" href="#create-a-new-policy-file" title="Permalink to this heading"></a></h3>
<p>Create a new Python file under the <code class="docutils literal notranslate"><span class="pre">lzero/policy</span></code> directory. This file will contain your algorithm implementation. For example, if your algorithm is called MyAlgorithm, you can create a file named <code class="docutils literal notranslate"><span class="pre">my_algorithm.py</span></code>.</p>
</section>
<section id="implement-your-policy">
<h3>3. Implement Your Policy<a class="headerlink" href="#implement-your-policy" title="Permalink to this heading"></a></h3>
<p>Within your policy file, you need to define a class to implement your strategy. This class should inherit from the <code class="docutils literal notranslate"><span class="pre">Policy</span></code> class in DI-engine and implement required methods. Below is a basic framework for a policy class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@POLICY_REGISTRY</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;my_algorithm&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyAlgorithmPolicy</span><span class="p">(</span><span class="n">Policy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overview:</span>
<span class="sd">        The policy class for MyAlgorithm.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="c1"># Add your config here</span>
    <span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Initialize your policy here</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="c1"># Set the default model name and the import path so that the default model can be loaded during policy initialization</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_init_learn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize the learn mode here</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_forward_learn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Implement the forward function for learning mode here</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_init_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize the collect mode here</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_forward_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Implement the forward function for collect mode here</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_init_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize the eval mode here</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_forward_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Implement the forward function for eval mode here</span>
</pre></div>
</div>
<section id="data-collection-and-model-evaluation">
<h4>Data Collection and Model Evaluation<a class="headerlink" href="#data-collection-and-model-evaluation" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">default_model</span></code>, set the class name of the default model used by the current policy and the corresponding reference path.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_init_collect</span></code> and <code class="docutils literal notranslate"><span class="pre">_init_eval</span></code> functions are responsible for instantiating the action selection policy, and the respective policy instances will be called by the _forward_collect and _forward_eval functions.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_forward_collect</span></code> function takes the current state of the environment and selects a step action by calling the instantiated policy in <code class="docutils literal notranslate"><span class="pre">_init_collect</span></code>. The function returns the selected action list and other relevant information. During training, this function is called through the <code class="docutils literal notranslate"><span class="pre">collector.collect</span></code> method of the Collector object created by the Entry file.</p></li>
<li><p>The logic of the <code class="docutils literal notranslate"><span class="pre">_forward_eval</span></code> function is similar to that of the <code class="docutils literal notranslate"><span class="pre">_forward_collect</span></code>function. The only difference is that the policy used in <code class="docutils literal notranslate"><span class="pre">_forward_collect</span></code> is more focused on exploration to collect diverse training information, while the policy used in <code class="docutils literal notranslate"><span class="pre">_forward_eval</span></code> is more focused on exploitation to obtain the optimal performance of the current policy. During training, this function is called through the <code class="docutils literal notranslate"><span class="pre">evaluator.eval</span></code> method of the Evaluator object created by the Entry file.</p></li>
</ul>
</section>
<section id="policy-learning">
<h4>Policy Learning<a class="headerlink" href="#policy-learning" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">_init_learn</span></code> function initializes the network model, optimizer, and other objects required during training using the associated parameters of the strategy, such as learning rate, update frequency, optimizer type, passed in from the config file.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_forward_learn</span></code> function is responsible for updating the network. Typically, the <code class="docutils literal notranslate"><span class="pre">_forward_learn</span></code> function receives the data collected by the Collector, calculates the loss function based on this data, and performs gradient updates. The function returns the various losses during the update process and the relevant parameters used for the update, for experimental recording purposes. During training, this function is called through the <code class="docutils literal notranslate"><span class="pre">learner.train</span></code> method of the Learner object created by the Entry file.</p></li>
</ul>
</section>
</section>
<section id="register-your-policy">
<h3>4. Register Your Policy<a class="headerlink" href="#register-your-policy" title="Permalink to this heading"></a></h3>
<p>To make LightZero recognize your policy, you need to use the <code class="docutils literal notranslate"><span class="pre">&#64;POLICY_REGISTRY.register('my_algorithm')</span></code> decorator above your policy class to register your policy. This way, LightZero can refer to your policy by the name ‘my_algorithm’. Specifically, in the experiment’s configuration file, the corresponding algorithm is specified through the <code class="docutils literal notranslate"><span class="pre">create_config</span></code> section:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">create_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="n">policy</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;my_algorithm&#39;</span><span class="p">,</span>
        <span class="n">import_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lzero.policy.my_algorithm&#39;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">type</span></code> should be set to the registered policy name, and <code class="docutils literal notranslate"><span class="pre">import_names</span></code> should be set to the location of the policy package.</p>
</section>
<section id="possible-other-modifications">
<h3>5. Possible Other Modifications<a class="headerlink" href="#possible-other-modifications" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Model</strong>: The LightZero <code class="docutils literal notranslate"><span class="pre">model.common</span></code> package provides some common network structures, such as the <code class="docutils literal notranslate"><span class="pre">RepresentationNetwork</span></code> that maps 2D images to a latent space representation and the <code class="docutils literal notranslate"><span class="pre">PredictionNetwork</span></code> used in MCTS for predicting probabilities and node values. If a custom policy requires a specific network model, you need to implement the corresponding model under the <code class="docutils literal notranslate"><span class="pre">model</span></code> folder. For example, the model for the MuZero algorithm is saved in the <code class="docutils literal notranslate"><span class="pre">muzero_model.py</span></code> file, which implements the <code class="docutils literal notranslate"><span class="pre">DynamicsNetwork</span></code> required by the MuZero algorithm and ultimately creates the <code class="docutils literal notranslate"><span class="pre">MuZeroModel</span></code> by calling the existing network structures in the <code class="docutils literal notranslate"><span class="pre">model.common</span></code> package.</p></li>
<li><p><strong>Worker</strong>: LightZero provides corresponding <code class="docutils literal notranslate"><span class="pre">worker</span></code> for AlphaZero and MuZero. Subsequent algorithms like EfficientZero and GumbelMuzero inherit the <code class="docutils literal notranslate"><span class="pre">worker</span></code> from MuZero. If your algorithm has different logic for data collection, you need to implement the corresponding <code class="docutils literal notranslate"><span class="pre">worker</span></code>. For example, if your algorithm requires preprocessing of collected transitions, you can add this segment under the <code class="docutils literal notranslate"><span class="pre">collect</span></code> function of the collector, in which the <code class="docutils literal notranslate"><span class="pre">get_train_sample</span></code> function implements the specific data processing process.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">timestep</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
    <span class="c1"># Prepare trajectory data.</span>
    <span class="n">transitions</span> <span class="o">=</span> <span class="n">to_tensor_transitions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traj_buffer</span><span class="p">[</span><span class="n">env_id</span><span class="p">])</span>
    <span class="c1"># Use ``get_train_sample`` to process the data.</span>
    <span class="n">train_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">get_train_sample</span><span class="p">(</span><span class="n">transitions</span><span class="p">)</span>
    <span class="n">return_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">train_sample</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_traj_buffer</span><span class="p">[</span><span class="n">env_id</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="test-your-policy">
<h3>6. Test Your Policy<a class="headerlink" href="#test-your-policy" title="Permalink to this heading"></a></h3>
<p>After implementing your strategy, it is crucial to ensure its correctness and effectiveness. To do so, you should write some unit tests to verify that your strategy is functioning correctly. For example, you can test if the strategy can execute in a specific environment and if the output of the strategy matches the expected results. You can refer to the <a class="reference external" href="https://di-engine-docs.readthedocs.io/zh_CN/latest/22_test/index_zh.html">documentation</a> in the DI-engine for guidance on how to write unit tests. You can add your tests in the <code class="docutils literal notranslate"><span class="pre">lzero/policy/tests</span></code>. When writing tests, try to consider all possible scenarios and boundary conditions to ensure your strategy can run properly in various situations.</p>
<p>Here is an example of unit testing in LightZero. In this example, we test the <code class="docutils literal notranslate"><span class="pre">inverse_scalar_transform</span></code> and <code class="docutils literal notranslate"><span class="pre">InverseScalarTransform</span></code>methods. Both methods reverse the transformation of a given value, but they have different implementations. In the unit test, we apply these two methods to the same set of data and compare the output results. If the results are the same, the test passes.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lzero.policy.scaling_transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">DiscreteSupport</span><span class="p">,</span> <span class="n">inverse_scalar_transform</span><span class="p">,</span> <span class="n">InverseScalarTransform</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unittest</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_scaling_transform</span><span class="p">():</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
    <span class="n">logit</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">601</span><span class="p">)</span>
    <span class="n">discrete_support</span> <span class="o">=</span> <span class="n">DiscreteSupport</span><span class="p">(</span><span class="o">-</span><span class="mf">300.</span><span class="p">,</span> <span class="mf">301.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">output_1</span> <span class="o">=</span> <span class="n">inverse_scalar_transform</span><span class="p">(</span><span class="n">logit</span><span class="p">,</span> <span class="n">discrete_support</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">InverseScalarTransform</span><span class="p">(</span><span class="n">discrete_support</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">output_2</span> <span class="o">=</span> <span class="n">handle</span><span class="p">(</span><span class="n">logit</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">output_1</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">output_2</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">output_1</span> <span class="o">==</span> <span class="n">output_2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>In the unit test file, you need to mark the tests with <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.unittest</span></code> to include them in the Python testing framework. This allows you to run the unit test file directly by entering <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-sv</span> <span class="pre">xxx.py</span></code> in the command line. <code class="docutils literal notranslate"><span class="pre">-sv</span></code> is a command option that, when used, prints detailed information to the terminal during the test execution for easier inspection.</p>
</section>
<section id="comprehensive-testing-and-running">
<h3>7. Comprehensive Testing and Running<a class="headerlink" href="#comprehensive-testing-and-running" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>After ensuring the basic functionality of the policy, you need to use classic environments like cartpole to conduct comprehensive correctness and convergence tests on your policy. This is to verify that your policy can work effectively not only in unit tests but also in real game environments.</p></li>
<li><p>You can write related configuration files and entry programs by referring to <code class="docutils literal notranslate"><span class="pre">cartpole_muzero_config.py</span></code>. During the testing process, pay attention to record performance data of the policy, such as the score of each round, the convergence speed of the policy, etc., for analysis and improvement.</p></li>
</ul>
</section>
<section id="contribution">
<h3>8. Contribution<a class="headerlink" href="#contribution" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>After completing all the above steps, if you wish to contribute your policy to the LightZero repository, you can submit a Pull Request on the official repository. Before submission, ensure your code complies with the repository’s coding standards, all tests have passed, and there are sufficient documents and comments to explain your code and policy.</p></li>
<li><p>In the description of the PR, explain your policy in detail, including its working principle, your implementation method, and its performance in tests. This will help others understand your contribution and speed up the PR review process.</p></li>
</ul>
</section>
<section id="share-discuss-and-improve">
<h3>9. Share, Discuss, and Improve<a class="headerlink" href="#share-discuss-and-improve" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>After implementing and testing the policy, consider sharing your results and experiences with the community. You can post your policy and test results on forums, blogs, or social media and invite others to review and discuss your work. This not only allows you to receive feedback from others but also helps you build a professional network and may trigger new ideas and collaborations.</p></li>
<li><p>Based on your test results and community feedback, continuously improve and optimize your policy. This may involve adjusting policy parameters, improving code performance, or solving problems and bugs that arise. Remember, policy development is an iterative process, and there’s always room for improvement.</p></li>
</ul>
</section>
</section>
<section id="considerations">
<h2><strong>Considerations</strong><a class="headerlink" href="#considerations" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Ensure that your code complies with the Python PEP8 coding standards.</p></li>
<li><p>When implementing methods like <code class="docutils literal notranslate"><span class="pre">_forward_learn</span></code>, <code class="docutils literal notranslate"><span class="pre">_forward_collect</span></code>, and <code class="docutils literal notranslate"><span class="pre">_forward_eval</span></code>, ensure that you correctly handle input and returned data.</p></li>
<li><p>When writing your policy, ensure that you consider different types of environments. Your policy should be able to handle various environments.</p></li>
<li><p>When implementing your policy, try to make your code as modular as possible, facilitating others to understand and reuse your code.</p></li>
<li><p>Write clear documentation and comments describing how your policy works and how your code implements this policy. Strive to maintain the core meaning of the content while enhancing its professionalism and fluency.</p></li>
</ul>
</section>
</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../installation/installation_and_quickstart.html" class="btn btn-neutral float-left" title="Installation and Quick Start Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../envs/customize_envs.html" class="btn btn-neutral float-right" title="How to Customize Your Environments in LightZero?" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, OpenDILab Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>